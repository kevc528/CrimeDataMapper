<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Penn Crime Mapper</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="css/fontastic.css">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="css/grasp_mobile_progress_circle-1.0.0.min.css">
    <!-- Custom Scrollbar-->
    <link rel="stylesheet" href="vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
      <style>
      #map {
        width: 100%;
        height: 600px;
        background-color: grey;
      }
      .button {
    display: block;
    width: 50px;
    height: 25px;
    background: #4E9CAF;
    padding: 10px;
    text-align: center;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    }
    </style>
  </head>
  <body>
    <!-- Side Navbar -->
    <nav class="side-navbar">
      <div class="side-navbar-wrapper">
        <!-- Sidebar Header    -->
        <div class="sidenav-header d-flex align-items-center justify-content-center">
          <!-- User Info-->
          <div class="sidenav-header-inner text-center"><img src="img/apple-icon.png" alt="person" class="img-fluid rounded-circle">
            <h2 class="h5">Penn Data Project</h2><span>Crime Map</span>
          </div>
          <!-- Small Brand information, appears on minimized sidebar-->
          <div class="sidenav-header-logo"><a href="https://www.facebook.com/pennaero/" class="brand-small text-center"> <strong>PDP</strong><strong class="text-primary"></strong></a></div>
        </div>
        <!-- Sidebar Navigation Menus-->
        <div class="main-menu">
          <h5 class="sidenav-heading">Filter Options</h5>
          <ul id="side-main-menu" class="side-menu list-unstyled">
            <li><input type="checkbox" id = "tbox" style="cursor: pointer;" onclick="tCrimes()" ></li>
            <label for="tbox">Thefts</label>
            <li><input type="checkbox" id = "abox" style="cursor: pointer;" onclick="aCrimes()" ></li>
            <label for="abox">Assaults</label>
            <li><input type="checkbox" id = "sbox" style="cursor: pointer;" onclick="sCrimes()" ></li>
            <label for="sbox">Sex Crimes</label>
            <li><input type="checkbox" id = "obox" style="cursor: pointer;" onclick="oCrimes()" ></li>
            <label for="obox">Other Crimes</label>



          </ul>
        </div>
      </div>
    </nav>
    <div class="page">
      <!-- navbar-->
      <header class="header">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <div class="navbar-header"><a id="toggle-btn" href="#" class="menu-btn"><i class="icon-bars"> </i></a><a href="https://www.facebook.com/pennaero/" class="navbar-brand">
                  <div class="brand-text d-none d-md-inline-block"><span>crime </span><strong class="text-primary">Map</strong></div></a></div>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">

  </div>
              <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">

              </ul>
            </div>
          </div>
        </nav>
      </header>
      <!-- Header Section-->
      <section class="dashboard-header section-padding">
        <div class="container-fluid">
            <div id="map"></div>


          <div class="row d-flex align-items-md-stretch">

          </div>
        </div>
      </section>
      <!-- Statistics Section-->
      <section class="statistics">
        <div class="container-fluid">
          <div class="row d-flex">
            <div class="col-lg-4">
              <!-- Income-->
              <div class="card user-activity">
                <h2 class="display h4">Timing Analysis </h2>
                <div class="number"><strong><span id = "server">No Connection</span></strong></div>
                <br>
                <h2 class="display h3">Last Known Position: </h2>
                <p style="font-size:18px;"><span id = "lat">Lat: </span></p>
                <p style="font-size:18px;"><span id = "lng">Lng: </span></p>
              </div>

            </div>
            <div class="col-lg-4">
              <!-- Monthly Usage-->
              <div class="card user-activity">
                <h2 class="display h4">Most Common Crime: </h2>
                <div class="number" id = "time"><strong id = "hours">00:</strong>
                <strong id = "minutes">00:</strong>
                <strong id = "seconds">00</strong>
                </div>
                <br>
                <h2 class="display h4">Sat Number: </h2>
                <div class="number"><strong><span id = "speed">L.O.S</strong></span></div>
              </div>

            </div>
            <div class="col-lg-4">
              <!-- Statistics Panel-->
              <div class="card user-activity">
                <h2 class="display h4">Altitude: </h2>
                <div class="number"><strong><span id = "alt">L.O.S </span></strong></div>
                <br>
                <h2 class="display h4">Course: </h2>
                <div class="number"><strong><span id = "temp">L.O.S</span></strong></div>
              </div>

            </div>
          </div>
        </div>
      </section>


      <footer class="main-footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <p>Penn Data Project</p>
            </div>
            <div class="col-sm-6 text-right">
              <p>Design by <a href="https://bootstrapious.com/p/bootstrap-4-dashboard" class="external">Bootstrapious</a></p>
              <!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions and it helps me to run Bootstrapious. Thank you for understanding :)-->
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- JavaScript files-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.25/gmaps.js"></script>


    <script src="vendor/popper.js/umd/popper.min.js"> </script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/grasp_mobile_progress_circle-1.0.0.min.js"></script>
    <script src="vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <script src="vendor/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="js/charts-home.js"></script>
    <!-- Main File-->
    <script src="js/front.js"></script>

  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9sXLs1zb4QOgSVmyTE-Pf4Vl-k2rMv_o&libraries=visualization">
</script>

    <script> 
var globalMap;
var allData = [];

var sexCrimes = [];
var thefts = [];
var assaults = [];
var other = [];

var sMapData = [];
var tMapData = [];
var aMapData = [];
var oMapData = [];

var sVisible = true;
var tVisible = false;
var aVisible = false;
var oVisible = false;

var sMapVisible = false;
var tMapVisible = false;
var aMapVisible = false;
var oMapVisible = false;

var philly = {lat: 39.9526, lng: -75.1652};
var markers = [];

function sCrimeH() {
	console.log(sMapData);
	sMap = new google.maps.visualization.HeatmapLayer({
	  data: sMapData
	});
	sMap.setMap(document.getElementById('map1'));
}

function aCrimeH() {
	aMap = new google.maps.visualization.HeatmapLayer({
	  data: aMapData
	});
	aMap.setMap(document.getElementById('map1'));
}

function tCrimeH() {
	tMap = new google.maps.visualization.HeatmapLayer({
	  data: tMapData
	});
	tMap.setMap(document.getElementById('map1'));
}

function oCrimeH() {
	oMap = new google.maps.visualization.HeatmapLayer({
	  data: oMapData
	});
	oMap.setMap(document.getElementById('map1'));
}
  
function sCrimes() {
  if (!sVisible) {
    hideSexCrimes();
  } else {
    showSexCrimes();
  }
  sVisible = !sVisible;
}

function aCrimes() {
  if (!aVisible) {
    showAssaults();
  } else {
    hideAssaults();
  }
  aVisible = !aVisible;
}

function tCrimes() {
  if (!tVisible) {
    showThefts();
  } else {
    hideThefts();
  }
  tVisible = !tVisible;
}

function oCrimes() {
  if (!oVisible) {
    showOthers();
  } else {
    hideOthers();
  }
  oVisible = !oVisible;
}
  
  function showSexCrimes() {
    for (var i = 0; i < sexCrimes.length; i++) {
      sexCrimes[i].setVisible(true);
    }
  }

  function hideSexCrimes() {
    for (var i = 0; i < sexCrimes.length; i++) {
      sexCrimes[i].setVisible(false);
    }
  }

  function showThefts() {
    for (var i = 0; i < thefts.length; i++) {
      thefts[i].setVisible(true);
    }
  }

  function hideThefts() {
    for (var i = 0; i < thefts.length; i++) {
      thefts[i].setVisible(false);
    }
  }

  function showAssaults() {
    for (var i = 0; i < assaults.length; i++) {
      assaults[i].setVisible(true);
    }
  }

  function hideAssaults() {
    for (var i = 0; i < assaults.length; i++) {
      assaults[i].setVisible(false);
    }
  }

  function showOthers() {
    for (var i = 0; i < other.length; i++) {
      other[i].setVisible(true);
    }
  }

  function hideOthers() {
    for (var i = 0; i < other.length; i++) {
      other[i].setVisible(false);
    }
  }

var allMarkers = [];
// Initialize and add the map
function initMap() {
  var map1 = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: philly,
    styles: [
            {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
            {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
            {
              featureType: 'administrative.locality',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'geometry',
              stylers: [{color: '#263c3f'}]
            },
            {
              featureType: 'poi.park',
              elementType: 'labels.text.fill',
              stylers: [{color: '#6b9a76'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry',
              stylers: [{color: '#38414e'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry.stroke',
              stylers: [{color: '#212a37'}]
            },
            {
              featureType: 'road',
              elementType: 'labels.text.fill',
              stylers: [{color: '#9ca5b3'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry',
              stylers: [{color: '#746855'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry.stroke',
              stylers: [{color: '#1f2835'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'labels.text.fill',
              stylers: [{color: '#f3d19c'}]
            },
            {
              featureType: 'transit',
              elementType: 'geometry',
              stylers: [{color: '#2f3948'}]
            },
            {
              featureType: 'transit.station',
              elementType: 'labels.text.fill',
              stylers: [{color: '#d59563'}]
            },
            {
              featureType: 'water',
              elementType: 'geometry',
              stylers: [{color: '#17263c'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.fill',
              stylers: [{color: '#515c6d'}]
            },
            {
              featureType: 'water',
              elementType: 'labels.text.stroke',
              stylers: [{color: '#17263c'}]
            }
          ]

  });
  globalMap = map1;

  var myFetch = fetch("http://localhost:8080/post");
  myFetch.then(function(response) {
  response.json().then(function(data) {
    allData = data;
    for (var i = 0; i < data.length; i++) {
      if (parseFloat(allData[i].lng) < -90) {
        continue;
      }
      let coordinate = {lat: parseFloat(allData[i].lat), lng: parseFloat(allData[i].lng)};
      let cat = allData[i].category;
      let upper = cat.charAt(0).toUpperCase() + cat.substring(1);
      var coord = new google.maps.LatLng(coordinate);

      let color;
      if (upper == 'Sex') {
      	color = 'red';
      } else if (upper == 'Assault') {
      	color = 'blue';
      } else if (upper == 'Theft') {
      	color = 'green';
      } else {
      	color = 'yellow';
      }

      let url = "http://maps.google.com/mapfiles/ms/icons/";
  	  url += color + "-dot.png";
      let marker = new google.maps.Marker({
        position: coordinate,
        icon: url,
        title: allData[i].category
      });


      var information = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<h1 id="firstHeading" class="firstHeading">' + upper + '</h1>'+
      '<div id="bodyContent">'+
      '<p>Date: ' + allData[i].date + '</p>'+
      '<p>Time: ' + allData[i].time + '</p>'+
      '<p>Address: ' + allData[i].address + '</p>'+
      '<p>Description: ' + allData[i].description + '</p>'+
      '</div>'+
      '</div>';

      marker.info = new google.maps.InfoWindow({
          content: information
      });

      google.maps.event.addListener(marker, 'mouseover', function() {
        marker.info.open(map1, marker);
      });

      google.maps.event.addListener(marker, 'mouseout', function() {
        marker.info.close(map1, marker);
      });
      
      marker.setMap(map1);
      allMarkers.push(marker);
      if (upper == 'Sex') {
        sexCrimes.push(marker);
        sMapData.push(coord);
      } else if (upper == 'Assault') {
        assaults.push(marker);
        aMapData.push(coord);
      } else if (upper == 'Theft') {
        thefts.push(marker);
        tMapData.push(coord);
      } else {
        other.push(marker);
        oMapData.push(coord);
      }

      // console.log(coordinate);
      marker.setVisible(false);
      }
  }).then(function() {
  	var heatMapData = [
  {location: new google.maps.LatLng(37.782, -122.447), weight: 0.5},
  new google.maps.LatLng(37.782, -122.445),
  {location: new google.maps.LatLng(37.782, -122.443), weight: 2},
  {location: new google.maps.LatLng(37.782, -122.441), weight: 3},
  {location: new google.maps.LatLng(37.782, -122.439), weight: 2},
  new google.maps.LatLng(37.782, -122.437),
  {location: new google.maps.LatLng(37.782, -122.435), weight: 0.5},

  {location: new google.maps.LatLng(37.785, -122.447), weight: 3},
  {location: new google.maps.LatLng(37.785, -122.445), weight: 2},
  new google.maps.LatLng(37.785, -122.443),
  {location: new google.maps.LatLng(37.785, -122.441), weight: 0.5},
  new google.maps.LatLng(37.785, -122.439),
  {location: new google.maps.LatLng(37.785, -122.437), weight: 2},
  {location: new google.maps.LatLng(37.785, -122.435), weight: 3}
];
      var sMap = new google.maps.visualization.HeatmapLayer({
		 data: heatMapData
	  });
	  console.log(sMap);
      sMap.setMap(document.getElementById('map1'));
      var tMap = new google.maps.visualization.HeatmapLayer({
		 data: tMapData
	  });
      tMap.setMap(document.getElementById('map1'));
      var aMap = new google.maps.visualization.HeatmapLayer({
		 data: aMapData
	  });
      aMap.setMap(document.getElementById('map1'));
      var oMap = new google.maps.visualization.HeatmapLayer({
		 data: oMapData
	  });
      oMap.setMap(document.getElementById('map1'));
  });
})
}

          

      /*
            <li><a onclick="tCrimes()" style="cursor: pointer;"> <i class="icon-clock"></i>Theft                             </a></li>
            <li><a onclick = "aCrimes()" style="cursor: pointer;"><i class="icon-flask"></i>Assault </a></li>
            <li><a onclick="sCrimes()" style="cursor: pointer;"> <i class="icon-close"></i>Sex Offense                             </a></li>
            <li><a onclick="oCrimes()" style="cursor: pointer;"> <i class="icon-close"></i>Other                             </a></li>
*/


    </script>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9sXLs1zb4QOgSVmyTE-Pf4Vl-k2rMv_o&callback=initMap">
    </script>
    <!--Load the API

  </body>
</html>